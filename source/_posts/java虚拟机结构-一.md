---
title: java虚拟机结构(一)
date: 2019-04-25 00:00:19
categories: 
- java
---

java虚拟机学习笔记
<!-- more -->
![虚拟机结构](E:\inagnone.github.io\source\_posts\pic\1240.png "")

# Class文件

精确定义了类与接口的表示形式，包括在平台相关的目标文件格式中一些细节上的惯例。

# 数据类型

java虚拟机可以操作的数据类型分给两类：

* ## 原始类型

  * ### 数值类型

    * #### 整数类型

      > 1. byte类型：8位有符号
      > 2. short类型：16位有符号
      > 3. int类型：32位有符号
      > 4. long类型：64位有符号 
      > 5. char类型：16位无符号

    * #### 浮点类型

      >1. float类型：32位单精度浮点数
      >2. double类型：64位双精度浮点数

  * ### boolean类型

    ​	布尔值true和false，默认false

  * ### returnAddress类型

    指向某个操作码的指针，操作码与java虚拟机指令相对应

* ## 数据类型

  * ### 类类型

    指向动态创建的类实例

  * ### 数组类型

    指向动态创建的数组实例

  * ### 接口类型

    指向实现了某个接口的类实例

# 运行时数据区

## pc寄存器

每一个线程都有自己的pc寄存器，且任意时刻都只会各自执行一个方法。如果当前方法时native[^native],pc寄存器保存java虚拟机正在执行的字节码指令的地址，如果不是native，pc寄存器保存undefined

[^native]: "java调用非java代码实现的接口"

## java虚拟机栈

每一个线程都有自己私有的java虚拟机栈，这个栈与线程同时创建，用于存储栈帧

>栈异常
>
>* stackOverflowError：线程请求分配的栈容量超过了虚拟机允许的最大容量
>* OutOfmemoryError：扩展栈或者创建一个新线程对应的新栈时，没有足够的内存

### 栈帧

用来存储数据和部分分派结果的数据结构，同时也是用来处理动态链接，方法返回值和异常分派

随方法调用而创建，随方法结束而销毁

栈帧的存储空间由创建它的线程分配在java虚拟机中

每一个栈帧都有自己的本地变量表（局部变量表），操作数栈和指向当前方法所属的类的运行时常量池的引用、

1. 局部变量表

   一个局部表量表可以保存一个类型为boolean、byte、char、short、int、float、reference、returnAddress的数据

   两个连续的局部变量可以保存一个类型为long或double的数据

   局部变量通过索引来进行访问

   当调用方法时，参数依次传递到从0开始的连续位置，当调用实例方法时，第0个变量一定是存储该实例方法所在对象的引用(即this关键字)

2. 操作数栈

   

3. 动态链接

   每一个栈帧内部都有一个指向当前方法所在类型的运行时常量池的引用，以便对当前方法的代码实现动态链接。在class文件里，一个方法调用其他方法，或者访问成员变量，则需要通过符号引用，动态链接的作用就是就是将这些符号引用所表示的方法转换为对实际方法的直接引用

## java堆

提供各线程共享的运行时内存区域，也是供所有类实例和数组对象分配内存的区域

堆在虚拟机启动时被创建，存储被gc管理的各种对象

## 方法区

提供各个线程共享的运行时内存区域。

存储一个类的结构信息(运行时常量池，字段，方法数据，构造函数，普通方法的字节码内容)

## 运行时常量池

是class文件中每一个类或者接口的常量池表的运行时表示形式

每一个运行时常量池都在java虚拟机的方法区中分配，在加载类和接口到虚拟机后，就创建对应的运行时常量池

## 本地方法栈

用来支持native方法执行的栈。(如果虚拟机不支持native方法，可以不提供本地方法栈)

本地方法栈在线程创建的时候按线程分配。





